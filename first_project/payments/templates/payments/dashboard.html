{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
            display: flex;
            opacity: 0;
            animation: fadeIn 0.3s ease-in forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .sidebar {
            width: 250px;
            background-color: #ffffff;
            border-radius: 0 20px 20px 0;
            box-shadow: 4px 0 6px rgba(0, 0, 0, 0.1);
            padding: 20px 0;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            transition: transform 0.3s ease;
        }
        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        .sidebar-header i {
            font-size: 40px;
            margin-right: 10px;
        }
        .sidebar-header h2 {
            font-size: 18px;
            color: #333333;
        }
        .sidebar-button {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 15px;
            text-align: left;
            color: #333333;
            text-decoration: none;
            border-bottom: 1px solid #e0e0e0;
            transition: background-color 0.3s ease;
        }
        .sidebar-button i {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
        .sidebar-button:last-child {
            border-bottom: none;
        }
        .sidebar-button:hover, .sidebar-button.active {
            background-color: #f0f0f0;
        }
        .content {
            margin-left: 270px;
            padding: 20px;
            width: calc(100% - 270px);
            transition: margin-left 0.3s ease;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .page-header h1 {
            font-size: 24px;
            color: #333333;
        }
        .container {
            display: flex;
            flex: 1;
            margin: 60px 20px 60px 20px;
        }
        .left-container {
            flex: 4;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .top-container {
            display: flex;
            gap: 20px;
        }
        .scale-container {
            display: flex;
            gap: 20px;
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            height: 250px;
        }
        .scale-options {
            width: 20%;
            border-right: 1px solid #ddd;
            padding-right: 10px;
        }
        .scale-options button {
            padding: 8px;
            font-size: 12px;
            width: 100%;
            text-align: left;
            border: none;
            background: none;
            cursor: pointer;
        }
        .scale-results {
            flex: 1;
            padding-left: 10px;
            overflow-x: auto;
        }
        .scale-results .row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
        }
        .scale-results .row div {
            flex: 1;
            text-align: left;
            font-size: 12px;
            color: #666;
        }
        .scale-results .row .value {
            font-size: 12px;
            font-weight: bold;
            color: #333;
        }
        .scale-options button:hover {
            background-color: #f1f1f1;
        }
        .charts-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            flex-wrap: wrap;
            width: 100%;
        }
        .chart-container {
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-height: 300px;
            flex: 2;
            width: 60%;
            margin: 0 auto;
        }
        .pie-chart-container {
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-height: 300px;
            flex: 1;
            width: 30%;
            margin: 0 auto;
        }
        .chart-container canvas,
        .pie-chart-container canvas {
            width: 100% !important;
            height: 100% !important;
        }
        .info-container {
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 10px;
            display: flex;
            flex-direction: column;
            max-height: 250px;
            flex: 2;
        }
        .info-container h2 {
            text-align: center;
            color: #0056b3;
            margin-bottom: 10px;
        }
        .search-bar {
            display: flex;
            margin-bottom: 10px;
            gap: 10px;
        }
        .search-bar input {
            flex: 1;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .search-bar input[type="date"] {
            flex: 1;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .info-list {
            flex: 1;
            overflow-y: auto;
            max-height: 200px;
            padding-right: 10px;
        }
        .info-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            border-bottom: 1px solid #ddd;
            transition: background-color 0.3s ease;
        }
        .info-list-item:hover {
            background-color: #e4e4e4;
            cursor: pointer;
        }
        .info-list-item a {
            text-decoration: none;
            color: inherit;
            display: flex;
            justify-content: space-between;
            width: 100%;
        }
        .info-list-item span {
            font-size: 14px;
            color: #555;
        }
        .info-list-item .name {
            flex: 1;
            font-weight: bold;
        }
        .info-list-item .date {
            flex: 1;
            text-align: center;
        }
        .info-list-item .profit {
            flex: 1;
            text-align: right;
            color: green;
        }
        .info-list-item .loss {
            flex: 1;
            text-align: right;
            color: red;
        }
        .info-list-item .other {
            flex: 1;
            text-align: right;
            color: black;
        }
        .no-results {
            font-size: 16px;
            color: gray;
            text-align: center;
        }
        .info-list::-webkit-scrollbar {
            width: 8px;
        }
        .info-list::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 10px;
        }
        .info-list::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                border-radius: 0;
                box-shadow: none;
                padding: 10px 0;
            }
            .sidebar-header {
                padding: 10px;
            }
            .sidebar-header i {
                font-size: 30px;
            }
            .sidebar-header h2 {
                font-size: 16px;
            }
            .sidebar-button {
                padding: 10px;
            }
            .content {
                margin-left: 0;
                width: 100%;
                padding: 10px;
            }
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .container {
                flex-direction: column;
                margin: 20px 10px;
            }
            .top-container {
                flex-direction: column;
                gap: 10px;
            }
            .scale-container {
                flex-direction: column;
                height: auto;
            }
            .scale-options {
                width: 100%;
                border-right: none;
                padding-right: 0;
            }
            .scale-results {
                padding-left: 0;
            }
            .charts-container {
                flex-direction: column;
                gap: 10px;
            }
            .chart-container, .pie-chart-container {
                width: 100%;
                max-height: none;
            }
            .info-container {
                max-height: none;
            }
            .search-bar {
                flex-direction: column;
            }
            .search-bar input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<div class="sidebar">
    <div class="sidebar-header">
        <i class="fa-brands fa-first-order"></i>
        <h2>Brand Name</h2>
    </div>
    <a href="{% url 'dashboard' %}" class="sidebar-button {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
        <i class="fa-solid fa-chart-line"></i>
        Dashboard
    </a>
    <a href="{% url 'payment_list' %}" class="sidebar-button {% if request.resolver_match.url_name == 'payment_list' %}active{% endif %}">
        <i class="fa-solid fa-credit-card"></i>
        Payment List
    </a>
    <a href="{% url 'product_list' %}" class="sidebar-button {% if request.resolver_match.url_name == 'product_list' %}active{% endif %}">
        <i class="fa-solid fa-basket-shopping"></i>
        Product List
    </a>
    <a href="{% url 'course_list' %}" class="sidebar-button {% if request.resolver_match.url_name == 'course_list' %}active{% endif %}">
        <i class="fa-solid fa-folder"></i>
        Course List
    </a>
    <a href="{% url 'student_list' %}" class="sidebar-button {% if request.resolver_match.url_name == 'student_list' %}active{% endif %}">
        <i class="fa-solid fa-graduation-cap"></i>
        Student List
    </a>
    <a href="{% url 'teacher_list' %}" class="sidebar-button {% if request.resolver_match.url_name == 'teacher_list' %}active{% endif %}">
        <i class="fa-solid fa-chalkboard-user"></i>
        Teacher List
    </a>
    <a href="{% url 'bank_account_list' %}" class="sidebar-button {% if request.resolver_match.url_name == 'bank_account_list' %}active{% endif %}">
        <i class="fa-solid fa-building-columns"></i>
        Bank Account List
    </a>
    <a href="{% url 'installment_list' %}" class="sidebar-button {% if request.resolver_match.url_name == 'installment_list' %}active{% endif %}">
        <i class="fa-regular fa-rectangle-list"></i>
        Installment List
    </a>
</div>
<div class="content">
    <div class="page-header">
        <h1>Dashboard</h1>
    </div>
    <div class="container">
        <div class="left-container">
            <div class="top-container">
                <div class="scale-container">
                    <div class="scale-options">
                        <button onclick="updateScale('Day')">Day</button>
                        <button onclick="updateScale('Week')">Week</button>
                        <button onclick="updateScale('Month')">Month</button>
                        <button onclick="updateScale('Year')">Year</button>
                    </div>
                    <div class="scale-results" id="scaleResults"></div>
                </div>
                <div class="info-container">
                    <div class="search-bar">
                        <input type="text" id="searchName" placeholder="Search by name" oninput="filterResults()">
                        <input type="date" id="startDate" onchange="filterResults()">
                        <input type="date" id="endDate" onchange="filterResults()">
                        <input type="number" id="searchLastN" placeholder="Last N actions" oninput="filterResults()">
                    </div>
                    <div class="info-list" id="infoList"></div>
                </div>
            </div>
            <div class="charts-container">
                <div class="chart-container">
                    <canvas id="profitLossChart"></canvas>
                </div>
                <div class="pie-chart-container">
                    <canvas id="pieChart"></canvas>
                </div>
                <div class="pie-chart-container">
                    <canvas id="personPieChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    const ctx = document.getElementById('profitLossChart').getContext('2d');
    let profitLossChart;

    const pieCtx = document.getElementById('pieChart').getContext('2d');
    let pieChart;

    let currentScale = 'Week';

    function renderActions(payments) {
        const infoList = document.getElementById('infoList');
        infoList.innerHTML = '';

        if (payments.length === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'no-results';
            noResults.textContent = 'No payments found';
            infoList.appendChild(noResults);
        } else {
            payments.forEach(payment => {
                const item = document.createElement('div');
                item.className = 'info-list-item';

                let amountColor = 'other';
                if (payment.payment_type__title === 'incoming') {
                    amountColor = 'profit';
                } else if (payment.payment_type__title === 'outgoing') {
                    amountColor = 'loss';
                }

                item.innerHTML = `
                    <a href="/payment-detail/${payment.id}/" style="text-decoration: none; color: inherit; display: flex; justify-content: space-between; width: 100%;">
                        <span class="name">${payment.name}</span>
                        <span class="date">${payment.datetime.split('T')[0]}</span>
                        <span class="${amountColor}">$${parseFloat(payment.amount).toFixed(2)}</span>
                    </a>
                `;
                infoList.appendChild(item);
            });
        }
    }

    function filterResults() {
        const nameFilter = document.getElementById('searchName').value.toLowerCase();
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const lastN = parseInt(document.getElementById('searchLastN').value);

        fetch('/api/payments/')
            .then(response => response.json())
            .then(data => {
                let filteredActions = data
                    .filter(payment => {
                        const matchesName = nameFilter ? payment.name.toLowerCase().includes(nameFilter) : true;

                        const paymentDate = new Date(payment.datetime);
                        const startDateObj = startDate ? new Date(startDate) : null;
                        const endDateObj = endDate ? new Date(endDate) : null;

                        const matchesDateRange = (!startDateObj || paymentDate >= startDateObj) &&
                                                (!endDateObj || paymentDate <= endDateObj);

                        return matchesName && matchesDateRange;
                    });

                filteredActions.sort((a, b) => new Date(b.datetime) - new Date(a.datetime));

                if (!isNaN(lastN) && lastN > 0) {
                    filteredActions = filteredActions.slice(0, lastN);
                }

                // Render the filtered actions
                renderActions(filteredActions);
            })
            .catch(error => {
                console.error('Error fetching payments:', error);
            });
    }

    function updateScale(scale) {
        currentScale = scale;
        fetch('/api/payments/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const payments = data;
                const scaleResults = document.getElementById('scaleResults');
                scaleResults.innerHTML = '';

                if (scale === 'Day') {
                    payments.forEach(payment => {
                        const overallProfit = payment.payment_type__title === 'incoming' ? parseFloat(payment.amount) : 0;
                        const overallLoss = payment.payment_type__title === 'outgoing' ? parseFloat(payment.amount) : 0;
                        const overallIncome = overallProfit - overallLoss;

                        const row = document.createElement('div');
                        row.className = 'row';
                        row.innerHTML = `
                            <div>${payment.name}</div>
                            <div>Overall Profit</div>
                            <div class="value" style="color: green;">$${overallProfit.toFixed(2)}</div>
                            <div>Overall Loss</div>
                            <div class="value" style="color: red;">$${overallLoss.toFixed(2)}</div>
                            <div>Overall Income</div>
                            <div class="value">$${overallIncome.toFixed(2)}</div>
                        `;
                        scaleResults.appendChild(row);
                    });
                } else {
                    const groupedPayments = groupPaymentsByScale(payments, scale);

                    groupedPayments.forEach(group => {
                        const row = document.createElement('div');
                        row.className = 'row';
                        row.innerHTML = `
                            <div>${group.key}</div>
                            <div>Overall Profit</div>
                            <div class="value" style="color: green;">$${group.overallProfit.toFixed(2)}</div>
                            <div>Overall Loss</div>
                            <div class="value" style="color: red;">$${group.overallLoss.toFixed(2)}</div>
                            <div>Overall Income</div>
                            <div class="value">$${group.overallIncome.toFixed(2)}</div>
                        `;
                        scaleResults.appendChild(row);
                    });
                }
            })
            .catch(error => {
                console.error('Error fetching payments:', error);
            });
    }

    function groupPaymentsByScale(payments, scale) {
        const groupedPayments = {};

        payments.forEach(payment => {
            const paymentDate = new Date(payment.datetime);
            let key;

            switch (scale) {
                case 'Day':
                    key = paymentDate.toISOString().split('T')[0]; // Group by day (e.g., "2023-10-01")
                    break;
                case 'Week':
                    const weekStart = new Date(paymentDate);
                    weekStart.setDate(paymentDate.getDate() - paymentDate.getDay()); // Start of the week (Sunday)
                    key = `${weekStart.getFullYear()}-W${Math.ceil((weekStart.getDate() + 6 - weekStart.getDay()) / 7)}`;
                    break;
                case 'Month':
                    key = `${paymentDate.getFullYear()}-${String(paymentDate.getMonth() + 1).padStart(2, '0')}`;
                    break;
                case 'Year':
                    key = paymentDate.getFullYear();
                    break;
                default:
                    key = 'All';
            }

            if (!groupedPayments[key]) {
                groupedPayments[key] = {
                    overallProfit: 0,
                    overallLoss: 0,
                    overallIncome: 0,
                };
            }

            const profit = payment.payment_type__title === 'incoming' ? parseFloat(payment.amount) : 0;
            const loss = payment.payment_type__title === 'outgoing' ? parseFloat(payment.amount) : 0;
            const income = profit - loss;

            groupedPayments[key].overallProfit += profit;
            groupedPayments[key].overallLoss += loss;
            groupedPayments[key].overallIncome += income;
        });

        return Object.entries(groupedPayments).map(([key, group]) => ({
            key,
            ...group,
        }));
    }

    function fetchPayments() {
        fetch('/api/payments/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const payments = data;

                renderActions(payments);

                const labels = generateLabels(payments, currentScale);
                const groupedData = groupPaymentsByScale(payments, currentScale);

                const profitData = groupedData.map(group => group.overallProfit);
                const lossData = groupedData.map(group => group.overallLoss);
                const incomeData = groupedData.map(group => group.overallIncome);

                if (profitLossChart) {
                    profitLossChart.destroy();
                }

                profitLossChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Profit',
                                data: profitData,
                                borderColor: 'green',
                                borderWidth: 2,
                                fill: false,
                                tension: 0.1,
                            },
                            {
                                label: 'Loss',
                                data: lossData,
                                borderColor: 'red',
                                borderWidth: 2,
                                fill: false,
                                tension: 0.1,
                            },
                            {
                                label: 'Income',
                                data: incomeData,
                                borderColor: 'blue',
                                borderWidth: 2,
                                fill: false,
                                tension: 0.1,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: (context) => `${context.dataset.label}: $${context.raw.toFixed(2)}`,
                                },
                            },
                            zoom: {
                                pan: {
                                    enabled: true,
                                    mode: 'x',
                                    speed: 1,
                                    threshold: 10,
                                },
                                zoom: {
                                    pan: {
                                        enabled: true,
                                        mode: 'x',
                                        speed: 1,
                                        threshold: 10,
                                    },
                                    zoom: {
                                        wheel: { enabled: true }, // Enable zooming with the mouse wheel
                                        pinch: { enabled: true }, // Enable zooming with pinch gestures (touchpad)
                                        mode: 'x', // Zoom only on the x-axis
                                        speed: 0.05, // Control the speed of zooming
                                        limits: {
                                            x: { minRange: 1 }, // Minimum range for the x-axis
                                        },
                                        onZoomComplete: ({ chart }) => {
                                            const xAxis = chart.scales.x;
                                            const range = xAxis.max - xAxis.min;
                                            const newScale = getDynamicScale(range);
                                            if (newScale !== currentScale) {
                                                currentScale = newScale;
                                                updateScale(currentScale); // Update the scale dynamically
                                            }
                                        },
                                    },
                                },
                            },
                        },
                        scales: {
                            y: {
                                ticks: {
                                    callback: (value) => `$${value}`,
                                },
                            },
                            x: {
                                ticks: {
                                    autoSkip: true,
                                },
                            },
                        },
                        animation: {
                            duration: 1000, // Animation duration in milliseconds
                            easing: 'easeInOutQuad', // Smooth animation
                        },
                    },
                });

                const totalIncoming = payments
                    .filter(payment => payment.payment_type__title === 'incoming')
                    .reduce((acc, payment) => acc + parseFloat(payment.amount), 0);

                const totalOutgoing = payments
                    .filter(payment => payment.payment_type__title === 'outgoing')
                    .reduce((acc, payment) => acc + parseFloat(payment.amount), 0);

                const totalOther = payments
                    .filter(payment => payment.payment_type__title !== 'incoming' && payment.payment_type__title !== 'outgoing')
                    .reduce((acc, payment) => acc + parseFloat(payment.amount), 0);

                if (pieChart) {
                    pieChart.destroy();
                }

                pieChart = new Chart(pieCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Incoming', 'Outgoing', 'Other'],
                        datasets: [
                            {
                                data: [totalIncoming, totalOutgoing, totalOther],
                                backgroundColor: ['green', 'red', 'blue'],
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            },
                            tooltip: {
                                callbacks: {
                                    label: (context) => `${context.label}: $${context.raw.toFixed(2)}`,
                                },
                            },
                        },
                        animation: {
                            duration: 1000, // Animation duration in milliseconds
                            easing: 'easeInOutQuad', // Smooth animation
                        },
                    },
                });

                const personPieCtx = document.getElementById('personPieChart').getContext('2d');
                let personPieChart;

                const personPayments = payments.reduce((acc, payment) => {
                    if (!acc[payment.name]) {
                        acc[payment.name] = 0;
                    }
                    acc[payment.name] += parseFloat(payment.amount);
                    return acc;
                }, {});

                const sortedPersons = Object.entries(personPayments)
                    .sort((a, b) => b[1] - a[1])
                    .map(([name, amount]) => ({ name, amount }));

                const topN = 5; // Change this value to control the number of people shown
                const topPersons = sortedPersons.slice(0, topN);

                const personLabels = topPersons.map(person => person.name);
                const personData = topPersons.map(person => person.amount);

                const professionalColors = [
                    '#4e79a7', '#f28e2c', '#e15759', '#76b7b2', '#59a14f',
                    '#edc949', '#af7aa1', '#ff9da7', '#9c755f', '#bab0ac'
                ];

                if (personPieChart) {
                    personPieChart.destroy();
                }

                personPieChart = new Chart(personPieCtx, {
                    type: 'pie',
                    data: {
                        labels: personLabels,
                        datasets: [
                            {
                                data: personData,
                                backgroundColor: professionalColors, // Use professional color palette
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            },
                            tooltip: {
                                callbacks: {
                                    label: (context) => `${context.label}: $${context.raw.toFixed(2)}`,
                                },
                            },
                        },
                        animation: {
                            duration: 1000, // Animation duration in milliseconds
                            easing: 'easeInOutQuad', // Smooth animation
                        },
                    },
                });
            })
            .catch(error => {
                console.error('Error fetching payments:', error);
            });
    }

    function generateLabels(payments, scale) {
        const labels = [];
        const dateMap = {};

        payments.forEach(payment => {
            const paymentDate = new Date(payment.datetime);
            let key;

            switch (scale) {
                case 'Day':
                    key = paymentDate.toISOString().split('T')[0]; // Label by day (e.g., "2023-10-01")
                    break;
                case 'Week':
                    const weekStart = new Date(paymentDate);
                    weekStart.setDate(paymentDate.getDate() - paymentDate.getDay()); // Start of the week (Sunday)
                    key = `${weekStart.getFullYear()}-W${Math.ceil((weekStart.getDate() + 6 - weekStart.getDay()) / 7)}`;
                    break;
                case 'Month':
                    key = `${paymentDate.getFullYear()}-${String(paymentDate.getMonth() + 1).padStart(2, '0')}`;
                    break;
                case 'Year':
                    key = paymentDate.getFullYear();
                    break;
                default:
                    key = 'All';
            }

            if (!dateMap[key]) {
                dateMap[key] = true;
                labels.push(key);
            }
        });

        return labels;
    }

    function getDynamicScale(range) {
        if (range <= 7) {
            return 'Day';
        } else if (range <= 30) {
            return 'Week';
        } else if (range <= 365) {
            return 'Month';
        } else {
            return 'Year';
        }
    }

    document.getElementById('searchName').addEventListener('input', filterResults);
    document.getElementById('startDate').addEventListener('change', filterResults);
    document.getElementById('endDate').addEventListener('change', filterResults);
    document.getElementById('searchLastN').addEventListener('input', filterResults);

    window.onload = function () {
        currentScale = 'Day';
        updateScale(currentScale);
        fetchPayments();
    };
</script>
</body>
</html>